<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<title>G1: The On-Disk Format &mdash; remexre.xyz</title>
		<link rel="stylesheet" type="text/css" href="https:&#x2F;&#x2F;remexre.xyz&#x2F;css/main.css">
		
	</head>
	<body>
		<header>
			<a class="subtle" href="https:&#x2F;&#x2F;remexre.xyz&#x2F;">Home</a>
			<a class="subtle" href="https:&#x2F;&#x2F;remexre.xyz&#x2F;tags">Tags</a>
			<a class="subtle" href="https:&#x2F;&#x2F;remexre.xyz&#x2F;contact">Contact</a>
			<a class="subtle" href="https:&#x2F;&#x2F;remexre.xyz&#x2F;projects">Projects</a>
		</header>
		<div class="spacer"></div>
		
<article>
	<h1 class="title">
		<a class="subtle" href="https:&#x2F;&#x2F;remexre.xyz&#x2F;g1&#x2F;disk&#x2F;">G1: The On-Disk Format</a>
		<span class="spacer"></span>
		<span class="meta">
			Draft</span>
	</h1>
	<p><em>This post assumes you've read the <a href="https://remexre.xyz/g1/query-lang/">previous one in the series</a>.</em></p>
<p>Currently, I'm not caring all that much about maximum efficiency, instead preferring a simple approach. This approach is therefore based off of what a &quot;real&quot; database might do, but much simpler.</p>
<p>At a high level, the on-disk format is an append-only structure composed of fixed-length blocks, which define several immutable data structures, all linked to by the final block:</p>
<pre style="background-color:#272822;">
<span style="color:#f8f8f2;">               +---------+         +-----------------------------+
               |         |         |                             |
               v         |         v                             |
+---------+---------+---------+---------+---------+---------+---------+---------+
| Initial |  Atoms  |  Atoms  |  Edges  |  Attrs  | Garbage |  Edges  |   Meta  |
|         |    1    |    2    |    1    |    1    |         |    2    |   data  |
+---------+---------+---------+---------+---------+---------+---------+---------+
                         ^                   ^                   ^         |
                         |                   |                   |         |
                         +-------------------+-------------------+---------+
</span></pre>
<p>This has the advantage that since blocks before (and including) the metadata block are immutable, the slow write operation doesn't block any read operations, nor invalidate the page cache. Additionally, the &quot;undo log&quot; is very simple -- just the old length. Furthermore, the only operations that need to be serialized are writes, and serializing writes provides isolation. Most of the data structures are functional trees of various sorts.</p>

</article>
<script src="https://utteranc.es/client.js" repo="remexre/remexre.github.io"
		issue-number="1234" label="comments" theme="github-dark"
		crossorigin="anonymous" async>
	</script>
	<div class="comments">
		<!-- This needs to be in a div because the NoScript extension transforms noscript
		elements into spans, while also getting rid of id and class, so applying CSS is no
		longer possible (without awful, awful hacks). -->
		<noscript>
			<hr>
			Comments (powered by
			<a href="https://utteranc.es">utteranc.es</a>) require
			JavaScript. However, you can comment directly on the
			<a href="https://github.com/remexre/remexre.github.io/issues/1234">GitHub issue</a>
			that stores the comments.
		</noscript>
	</div>

		<div class="spacer"></div>
		
<script src="https:&#x2F;&#x2F;remexre.xyz&#x2F;ext/anchor.min.js"></script>
<script>
	const anchors = new AnchorJS();
	anchors.options.class = "icon subtle";
	anchors.options.placement = "left";
	anchors.add("article h1:not(.title), article h2");
</script>

	</body>
</html>
