<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Arithmetic Example</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <style>
  body {
  	border: 1px solid gray;
  	margin: 0 auto;
  	padding: 0 1em;
  	max-width: 1000px;
  }
  .silver {
  	padding-left: 5em;
  	color: steelblue;
  }
  code span.st { color: tan; }
  pre.silver { margin-top: 10em; }
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Arithmetic Example</h1>
</header>
<p>This post is runnable (and part of the executable specification’s test suite); in it, I’ll try to explain the translation and evaluation of a simple grammar.</p>
<p>Most of these imports are boilerplatey, but note that <code>Language.SilvIR.Helpers</code> provides helpers to avoid thinking about A-Normal Form; any term of type <code>M a</code> can be ANFified to a term of type <code>a</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="ot">{-# LANGUAGE OverloadedLists #-}</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="ot">{-# LANGUAGE OverloadedStrings #-}</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="kw">module</span> <span class="dt">Language.SilvIR.Tests.Arith</span> (arithGrammar, tests) <span class="kw">where</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a><span class="kw">import</span> <span class="dt">Data.Function</span> ((&amp;))</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a><span class="kw">import</span> <span class="dt">Data.Sequence</span> (<span class="dt">Seq</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a><span class="kw">import</span> <span class="dt">Language.SilvIR</span> (<span class="dt">Expr</span>, <span class="dt">TopLevelItem</span>, <span class="dt">Value</span> (..), runGrammar, showValue)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a><span class="kw">import</span> <span class="dt">Language.SilvIR.Helpers</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a><span class="kw">import</span> <span class="dt">Test.Tasty</span> (<span class="dt">TestTree</span>, testGroup)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a><span class="kw">import</span> <span class="dt">Test.Tasty.HUnit</span> (testCase, (@?=))</span></code></pre></div>
<h2 id="translation">Translation</h2>
<pre class="silver"><code>grammar arith;</code></pre>
<p>The <code>grammar</code> decides the namespace part of all the namespaced names in the IR, but doesn’t itself generate any IR.</p>
<pre class="silver"><code>inherited attribute context::[Pair&lt;String Integer&gt;];
synthesized attribute value::Integer;

nonterminal Expr with context, value;</code></pre>
<p>Because <code>context</code> and <code>value</code> aren’t automatic attributes of any sort, they don’t get translated to anything.</p>
<pre class="silver"><code>abstract production add
top::Expr ::= l::Expr  r::Expr
{</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="ot">addProduction ::</span> <span class="dt">Seq</span> (<span class="dt">M</span> <span class="dt">TopLevelItem</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>addProduction <span class="ot">=</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>  [ productionDecl (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>) (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;Expr&quot;</span>)</span></code></pre></div>
<p>When an <code style="color: steelblue">abstract production</code> is encountered, it translates down to both a <code>productionDecl</code> to declare the production’s nonterminal, and to a <code>productionBody</code> for each equation in its body. (The equations can be combined in this case, but in general they may have different priorities.) All equations have a priority of 0, though of course the exact numbering can be changed to whatever, as long as the ordering remains the same.</p>
<pre class="silver"><code>  l.context = top.context;</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a>  , productionBody (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>) <span class="dv">0</span> [<span class="st">&quot;top&quot;</span>] <span class="op">$</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>      setAttr (getChild <span class="dv">0</span> (var <span class="st">&quot;top&quot;</span>)) (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;context&quot;</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a>              (thunk (force (getAttr (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;context&quot;</span>) (var <span class="st">&quot;top&quot;</span>))))</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a>              (var <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<p>Production bodies are functions that are composed at tree-construction-time, from the tree to the tree. They perform mutations to the tree (or its children, attributes, etc.) to effect the equations.</p>
<pre class="silver"><code>  r.context = top.context;</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a>  , productionBody (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>) <span class="dv">0</span> [<span class="st">&quot;top&quot;</span>] <span class="op">$</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a>      setAttr (getChild <span class="dv">1</span> (var <span class="st">&quot;top&quot;</span>)) (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;context&quot;</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a>              (thunk (force (getAttr (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;context&quot;</span>) (var <span class="st">&quot;top&quot;</span>))))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a>              (var <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<p>Note that accessing the parent’s inherited attributes requires a <code>thunk . force</code>. This is somewhat unideal, but speeds up tree construction. See <a href="#tree-construction-order">below</a> for discussion.</p>
<pre class="silver"><code>  top.value = l.value + r.value;</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a>  , productionBody (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>) <span class="dv">0</span> [<span class="st">&quot;top&quot;</span>] <span class="op">$</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a>      setAttr (var <span class="st">&quot;top&quot;</span>) (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;value&quot;</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a>              (thunk (pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a>                 [ force (getAttr (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;value&quot;</span>) (getChild <span class="dv">0</span> (var <span class="st">&quot;top&quot;</span>)))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a>                 , force (getAttr (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;value&quot;</span>) (getChild <span class="dv">1</span> (var <span class="st">&quot;top&quot;</span>)))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true"></a>                 ]))</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true"></a>              (var <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<p>Note that this equation is also thunked, as a consequence of the above.</p>
<pre class="silver"><code>}</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a>  ]</span></code></pre></div>
<p>If the above didn’t make sense, ask a question in <a href="https://github.com/melt-umn/silver/discussions/409">the GitHub discussion</a>.</p>
<pre class="silver"><code>abstract production let_
top::Expr ::= n::String  bound::Expr  body::Expr
{
  bound.context = top.context;
  top.value = body.value;</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a><span class="ot">letProduction ::</span> <span class="dt">Seq</span> (<span class="dt">M</span> <span class="dt">TopLevelItem</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a>letProduction <span class="ot">=</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a>  [ productionDecl (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;let_&quot;</span>) (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;Expr&quot;</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true"></a>  , productionBody (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;let_&quot;</span>) <span class="dv">0</span> [<span class="st">&quot;top&quot;</span>] <span class="op">$</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true"></a>      setAttr (getChild <span class="dv">1</span> (var <span class="st">&quot;top&quot;</span>)) (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;context&quot;</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true"></a>              (thunk (force (getAttr (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;context&quot;</span>) (var <span class="st">&quot;top&quot;</span>))))</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true"></a>              (var <span class="st">&quot;top&quot;</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true"></a>  , productionBody (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;let_&quot;</span>) <span class="dv">0</span> [<span class="st">&quot;top&quot;</span>] <span class="op">$</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true"></a>      setAttr (var <span class="st">&quot;top&quot;</span>) (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;value&quot;</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true"></a>              (thunk (force (getAttr (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;value&quot;</span>) (getChild <span class="dv">2</span> (var <span class="st">&quot;top&quot;</span>)))))</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true"></a>              (var <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<p>This proceeds similarly to the above. In this case, the <code>thunk . force</code> for the <code>body.value</code> expression is actually unnecessary. Without additional compile-time information, it can’t be optimized away, however. (I think this could be done either by keeping information that <code>arith:value</code> is a synthesized attribute, or by implementing the change mentioned above.)</p>
<pre class="silver"><code>  body.context = pair(n, bound.value) :: top.context;
}</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a>  , productionBody (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;let_&quot;</span>) <span class="dv">0</span> [<span class="st">&quot;top&quot;</span>] <span class="op">$</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a>      setAttr (getChild <span class="dv">2</span> (var <span class="st">&quot;top&quot;</span>)) (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;context&quot;</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true"></a>              (thunk (cons (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;cons&quot;</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true"></a>                 [ ( <span class="dt">ChildIsDeclaredDecorated</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true"></a>                   , thunk (cons (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;pair&quot;</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true"></a>                       [ (<span class="dt">ChildIsDeclaredDecorated</span>, thunk (getChild <span class="dv">0</span> (var <span class="st">&quot;top&quot;</span>)))</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true"></a>                       , (<span class="dt">ChildIsDeclaredDecorated</span>, getAttr (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;value&quot;</span>) (getChild <span class="dv">1</span> (var <span class="st">&quot;top&quot;</span>)))</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true"></a>                       ]</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true"></a>                       [ <span class="co">{- annotations -}</span> ])</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true"></a>                   )</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true"></a>                 , ( <span class="dt">ChildIsDeclaredDecorated</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true"></a>                   , getAttr (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;context&quot;</span>) (var <span class="st">&quot;top&quot;</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true"></a>                   )</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true"></a>                 ]</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true"></a>                 [ <span class="co">{- annotations -}</span> ]))</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true"></a>              (var <span class="st">&quot;top&quot;</span>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true"></a> ]</span></code></pre></div>
<p>This might change when lists become built in, but it demonstrates what constructing terms looks like. The translation is slightly strange though, since both <code style="color: steelblue">[]</code> and <code style="color: steelblue">Pair</code> are more like datatypes rather than terms. If they were to be translated as normal trees, they would be strict in their children. If they were to be translated as datatypes, they might be translated using records instead of nonterminal values. (I expect once a machine translation from Silver is actually implemented, lists will be translated to records and pairs will be strict in their children.)</p>
<pre class="silver"><code>abstract production lit
top::Expr ::= n::Integer
{ top.value = n; }</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a><span class="ot">litProduction ::</span> <span class="dt">Seq</span> (<span class="dt">M</span> <span class="dt">TopLevelItem</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true"></a>litProduction <span class="ot">=</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true"></a>  [ productionDecl (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;lit&quot;</span>) (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;Expr&quot;</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true"></a>  , productionBody (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;lit&quot;</span>) <span class="dv">0</span> [<span class="st">&quot;top&quot;</span>] <span class="op">$</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true"></a>      setAttr (var <span class="st">&quot;top&quot;</span>) (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;value&quot;</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true"></a>              (thunk (getChild <span class="dv">0</span> (var <span class="st">&quot;top&quot;</span>)))</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true"></a>              (var <span class="st">&quot;top&quot;</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true"></a>  ]</span></code></pre></div>
<p><code>lit</code> is the simplest case so far; nothing here should be surprising.</p>
<pre class="silver"><code>abstract production sub
top::Expr ::= l::Expr  r::Expr
{
  l.context = top.context;
  r.context = top.context;
  top.value = l.value - r.value;
}</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a><span class="ot">subProduction ::</span> <span class="dt">Seq</span> (<span class="dt">M</span> <span class="dt">TopLevelItem</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true"></a>subProduction <span class="ot">=</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true"></a>  [ productionDecl (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;sub&quot;</span>) (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;Expr&quot;</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true"></a>  , productionBody (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;sub&quot;</span>) <span class="dv">0</span> [<span class="st">&quot;top&quot;</span>] <span class="op">$</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true"></a>      setAttr (getChild <span class="dv">0</span> (var <span class="st">&quot;top&quot;</span>)) (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;context&quot;</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true"></a>              (thunk (force (getAttr (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;context&quot;</span>) (var <span class="st">&quot;top&quot;</span>))))</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true"></a>              (var <span class="st">&quot;top&quot;</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true"></a>  , productionBody (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;sub&quot;</span>) <span class="dv">0</span> [<span class="st">&quot;top&quot;</span>] <span class="op">$</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true"></a>      setAttr (getChild <span class="dv">1</span> (var <span class="st">&quot;top&quot;</span>)) (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;context&quot;</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true"></a>              (thunk (force (getAttr (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;context&quot;</span>) (var <span class="st">&quot;top&quot;</span>))))</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true"></a>              (var <span class="st">&quot;top&quot;</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true"></a>  , productionBody (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;sub&quot;</span>) <span class="dv">0</span> [<span class="st">&quot;top&quot;</span>] <span class="op">$</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true"></a>      setAttr (var <span class="st">&quot;top&quot;</span>) (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;value&quot;</span>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true"></a>              (thunk (pureForeign <span class="st">&quot;sub-int&quot;</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true"></a>                 [ force (getAttr (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;value&quot;</span>) (getChild <span class="dv">0</span> (var <span class="st">&quot;top&quot;</span>)))</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true"></a>                 , force (getAttr (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;value&quot;</span>) (getChild <span class="dv">1</span> (var <span class="st">&quot;top&quot;</span>)))</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true"></a>                 ]))</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true"></a>              (var <span class="st">&quot;top&quot;</span>)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true"></a>  ]</span></code></pre></div>
<p><code>sub</code> proceeds essentially the same as <code>add</code>.</p>
<pre class="silver"><code>abstract production var
top::Expr ::= n::String
{ top.value = lookup(n, top.context).fromJust; }</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true"></a><span class="ot">varProduction ::</span> <span class="dt">Seq</span> (<span class="dt">M</span> <span class="dt">TopLevelItem</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true"></a>varProduction <span class="ot">=</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true"></a>  [ productionDecl (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;var&quot;</span>) (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;Expr&quot;</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true"></a>  , productionBody (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;var&quot;</span>) <span class="dv">0</span> [<span class="st">&quot;top&quot;</span>] <span class="op">$</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true"></a>      setAttr (var <span class="st">&quot;top&quot;</span>) (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;value&quot;</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true"></a>              (thunk (force</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true"></a>                ( call</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true"></a>                    (force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true"></a>                    [ thunk (force (getAttr (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;context&quot;</span>) (var <span class="st">&quot;top&quot;</span>))),</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true"></a>                      thunk (getChild <span class="dv">0</span> (var <span class="st">&quot;top&quot;</span>))</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true"></a>                    ]</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true"></a>                )))</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true"></a>              (var <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<p>This translation is slightly inaccurate, since we define a simpler <code>lookupOrError</code> function instead of using <code style="color: steelblue">silver:core:lookup</code>. Note that, in keeping with Silver being a lazy language, the arguments to <code>lookupOrError</code> are thunks.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true"></a>  , globalItem (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>) <span class="op">.</span> lam [<span class="st">&quot;ctx&quot;</span>, <span class="st">&quot;name&quot;</span>] <span class="op">$</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true"></a>      case_ (force (var <span class="st">&quot;ctx&quot;</span>))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true"></a>        [ ( p&#39;nt (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;cons&quot;</span>) [p&#39;var <span class="st">&quot;h&quot;</span>, p&#39;var <span class="st">&quot;t&quot;</span>] []</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true"></a>          , case_ (force (var <span class="st">&quot;h&quot;</span>))</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true"></a>              [ ( p&#39;nt (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;pair&quot;</span>) [p&#39;var <span class="st">&quot;k&quot;</span>, p&#39;var <span class="st">&quot;v&quot;</span>] []</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true"></a>                , if_ (streq (force (var <span class="st">&quot;k&quot;</span>)) (force (var <span class="st">&quot;name&quot;</span>)))</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true"></a>                    (var <span class="st">&quot;v&quot;</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true"></a>                    (call (force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true"></a>                       [ var <span class="st">&quot;t&quot;</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true"></a>                       , var <span class="st">&quot;name&quot;</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true"></a>                       ])</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true"></a>                )</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true"></a>              ]</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true"></a>          )</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true"></a>        , ( p&#39;nt (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;nil&quot;</span>) [] []</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true"></a>          , error_ (lit (<span class="dt">V&#39;String</span> <span class="st">&quot;Couldn&#39;t find variable&quot;</span>))</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true"></a>          )</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true"></a>        ]</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true"></a>  ]</span></code></pre></div>
<p>Since we need the definition of <code>lookupOrError</code> <em>somewhere</em>, I’m shoving it in here. A full explanatino of this is out-of-scope for this document, and is likely subject to change, since I’m expecting patterns to need tweaking, <code>streq</code> to become a foreign function, etc.</p>
<pre class="silver"><code>function main 
IOVal&lt;Integer&gt; ::= args::[String]  ioIn::IO
{
  return ioval(print(toString(
    (decorate add(lit(2), let_(&quot;x&quot;, add(lit(3), lit(4)), sub(var(&quot;x&quot;), lit(5)))) with {
      context = [];
    }).value
  ), ioIn), 0);
}</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true"></a><span class="ot">mainFunction ::</span> <span class="dt">M</span> <span class="dt">TopLevelItem</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true"></a>mainFunction <span class="ot">=</span> globalItem (<span class="st">&quot;&quot;</span>, <span class="st">&quot;main&quot;</span>) <span class="op">.</span> lam [] <span class="op">$</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true"></a>  force (getAttr (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;value&quot;</span>) (decorate</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true"></a>    (cons (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true"></a>       [ ( <span class="dt">ChildIsNotDeclaredDecorated</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true"></a>         , cons (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;lit&quot;</span>) [(<span class="dt">ChildIsDeclaredDecorated</span>, lit (<span class="dt">V&#39;Int</span> <span class="dv">2</span>))] []</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true"></a>         )</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true"></a>       , ( <span class="dt">ChildIsNotDeclaredDecorated</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true"></a>         , cons (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;let_&quot;</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true"></a>             [ ( <span class="dt">ChildIsDeclaredDecorated</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true"></a>               , lit (<span class="dt">V&#39;String</span> <span class="st">&quot;x&quot;</span>)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true"></a>               )</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true"></a>             , ( <span class="dt">ChildIsNotDeclaredDecorated</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true"></a>               , cons (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true"></a>                   [ ( <span class="dt">ChildIsNotDeclaredDecorated</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true"></a>                     , cons (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;lit&quot;</span>) [(<span class="dt">ChildIsDeclaredDecorated</span>, lit (<span class="dt">V&#39;Int</span> <span class="dv">3</span>))] []</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true"></a>                     )</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true"></a>                   , ( <span class="dt">ChildIsNotDeclaredDecorated</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true"></a>                     , cons (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;lit&quot;</span>) [(<span class="dt">ChildIsDeclaredDecorated</span>, lit (<span class="dt">V&#39;Int</span> <span class="dv">4</span>))] []</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true"></a>                     )</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true"></a>                   ] []</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true"></a>               )</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true"></a>             , ( <span class="dt">ChildIsNotDeclaredDecorated</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true"></a>               , cons (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;sub&quot;</span>)</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true"></a>                   [ ( <span class="dt">ChildIsNotDeclaredDecorated</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true"></a>                     , cons (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;var&quot;</span>) [(<span class="dt">ChildIsDeclaredDecorated</span>, lit (<span class="dt">V&#39;String</span> <span class="st">&quot;x&quot;</span>))] []</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true"></a>                     )</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true"></a>                   , ( <span class="dt">ChildIsNotDeclaredDecorated</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true"></a>                     , cons (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;lit&quot;</span>) [(<span class="dt">ChildIsDeclaredDecorated</span>, lit (<span class="dt">V&#39;Int</span> <span class="dv">5</span>))] []</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true"></a>                     )</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true"></a>                   ] []</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true"></a>               )</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true"></a>             ] []</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true"></a>         )</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true"></a>       ] [])</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true"></a>    [ ( (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;context&quot;</span>)</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true"></a>      , thunk (cons (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;nil&quot;</span>) [] [])</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true"></a>      )</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true"></a>    ]))</span></code></pre></div>
<p>This isn’t an exact translation, because the SilvIR executable specification doesn’t have Silver’s IO primitives implemented; instead of printing the value, it returns it. Possibly of note is that the <code style="color: steelblue">Integer</code> and <code style="color: steelblue">String</code> children of <code style="color: steelblue">arith:let_</code>, <code style="color: steelblue">arith:lit</code>, and <code style="color: steelblue">arith:var</code> are marked as <code>ChildIsDeclaredDecorated</code> – this is so these children are treated as data rather than as a decorable subterm (and is why that flag needs a rename…).</p>
<p>Finally, let’s run the main function as a test, so we know all this works.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode haskell literate"><code class="sourceCode haskell"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true"></a><span class="ot">arithGrammar ::</span> <span class="dt">Seq</span> <span class="dt">TopLevelItem</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true"></a>arithGrammar <span class="ot">=</span> construct (<span class="fu">sequence</span> (addProduction <span class="op">&lt;&gt;</span> letProduction <span class="op">&lt;&gt;</span> litProduction <span class="op">&lt;&gt;</span> subProduction <span class="op">&lt;&gt;</span> varProduction))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true"></a><span class="ot">tests ::</span> <span class="dt">TestTree</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true"></a>tests <span class="ot">=</span> testCase <span class="st">&quot;Arith&quot;</span> <span class="op">$</span> <span class="kw">do</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true"></a>  <span class="kw">let</span> grammar <span class="ot">=</span> arithGrammar <span class="op">&lt;&gt;</span> [construct mainFunction]</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true"></a>  <span class="kw">let</span> (value, store) <span class="ot">=</span> runGrammar grammar</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true"></a>  showValue value store <span class="op">@?=</span> <span class="st">&quot;4&quot;</span></span></code></pre></div>
<p>(<code>construct :: M a -&gt; a</code> simply performs the ANF conversion.)</p>
<p>At this point, it all works! Run <code>cabal run</code> in the <code>silvir</code> directory to run these tests. Let’s now go through what all happens during evaluation.</p>
<h2 id="evaluation">Evaluation</h2>
<p>Note that code in this section is not part of the tests, not otherwise tested, and is pretty pseudo-codey anyway. For readability’s sake, I’ll use the following conventions:</p>
<ul>
<li><code>⟨⟩</code> to denote Silver-looking syntax for expressions that “trivially evaluate to” (i.e. <code>cons</code> and <code>lit</code>) SilvIR values</li>
<li>The package name part of namespaced names is removed in these expressions; in this example, it’s unambiguous what is meant.</li>
<li><code>foo@name</code> to give the above Silver-looking trees names (which serve as addresses)</li>
<li><code>where @name.foo = bar</code> to denote attribute values of heap objects</li>
<li><code>&lt;&gt;</code> to denote unforced thunks</li>
<li><code>«»</code> to denote forced thunks</li>
<li><code>{key1 = value1, key2 = value2}</code> to denote maps</li>
<li><code>foo.bar</code> for attribute access</li>
<li><code>foo.bar = baz then xyzzy</code> for attribute setting</li>
<li><code>foo.0</code> for child access</li>
<li><code>foo(bar, baz)</code> for function calls</li>
<li><code>_</code> embedded in an expression to denote contexts</li>
<li><code>in</code> to show the context stack</li>
</ul>
<p>With the above notational conventions, we start evaluating the body of main:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true"></a>force ((decorate ⟨add(lit(<span class="dv">2</span>), let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>), lit(<span class="dv">4</span>)), sub(var(<span class="st">&quot;x&quot;</span>), lit(<span class="dv">5</span>))))⟩ { context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span> })<span class="op">.</span>value)</span></code></pre></div>
<p>Since SilvIR is a call-by-value language, the redex is the <code>decorate</code> expression (after the trivial evaluation of the <code>cons</code> and <code>lit</code> expressions forming the <code>arith</code> value being decorated).</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true"></a>decorate ⟨add(lit(<span class="dv">2</span>), let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>), lit(<span class="dv">4</span>)), sub(var(<span class="st">&quot;x&quot;</span>), lit(<span class="dv">5</span>))))⟩ { context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span> }</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true"></a><span class="kw">in</span> force (_<span class="op">.</span>value)</span></code></pre></div>
<p>Decoration first decorates each child not marked <code>ChildIsDeclaredDecorated</code>, left to right, with an empty set of attributes.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true"></a>decorateChild ⟨lit(<span class="dv">2</span>)⟩</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>) [] _ [⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>), lit(<span class="dv">4</span>)), sub(var(<span class="st">&quot;x&quot;</span>), lit(<span class="dv">5</span>)))⟩]</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true"></a><span class="kw">in</span> decorateSetRootAttrs _ { context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span> }</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true"></a><span class="kw">in</span> force (_<span class="op">.</span>value)</span></code></pre></div>
<p>Since <code>⟨lit(2)⟩</code> has no decorable children, it now proceeds to have a tree allocated for it, and the production bodies that apply to it run in an arbitrary priority-respecting order.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true"></a>(lam [<span class="st">&quot;top&quot;</span>] <span class="op">$</span> (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>(var <span class="st">&quot;top&quot;</span>)<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span> <span class="kw">then</span> (var <span class="st">&quot;top&quot;</span>))(⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>) [] _ [⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>), lit(<span class="dv">4</span>)), sub(var(<span class="st">&quot;x&quot;</span>), lit(<span class="dv">5</span>)))⟩]</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true"></a><span class="kw">in</span> decorateSetRootAttrs _ { context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span> }</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true"></a><span class="kw">in</span> force (_<span class="op">.</span>value)</span></code></pre></div>
<p>This then beta-reduces.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true"></a>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span> <span class="kw">then</span> ⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>) [] _ [⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>), lit(<span class="dv">4</span>)), sub(var(<span class="st">&quot;x&quot;</span>), lit(<span class="dv">5</span>)))⟩]</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true"></a><span class="kw">in</span> decorateSetRootAttrs _ { context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span> }</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true"></a><span class="kw">in</span> force (_<span class="op">.</span>value)</span></code></pre></div>
<p>Setting the attribute is a mutation.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true"></a>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>) [] _ [⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>), lit(<span class="dv">4</span>)), sub(var(<span class="st">&quot;x&quot;</span>), lit(<span class="dv">5</span>)))⟩]</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true"></a><span class="kw">in</span> decorateSetRootAttrs _ { context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span> }</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true"></a><span class="kw">in</span> force (_<span class="op">.</span>value)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span></code></pre></div>
<p><code>⟨lit(2)@l2⟩</code> can be applied to the continuation.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true"></a>decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>) [] ⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩ [⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>), lit(<span class="dv">4</span>)), sub(var(<span class="st">&quot;x&quot;</span>), lit(<span class="dv">5</span>)))⟩]</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true"></a><span class="kw">in</span> decorateSetRootAttrs _ { context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span> }</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true"></a><span class="kw">in</span> force (_<span class="op">.</span>value)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span></code></pre></div>
<p>Decoration then proceeds to the next child.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true"></a>decorateChild ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>), lit(<span class="dv">4</span>)), sub(var(<span class="st">&quot;x&quot;</span>), lit(<span class="dv">5</span>)))⟩</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>) [⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩] _ []</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true"></a><span class="kw">in</span> decorateSetRootAttrs _ { context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span> }</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true"></a><span class="kw">in</span> force (_<span class="op">.</span>value)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span></code></pre></div>
<p>This again traverses down to the children of the term being decorated.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true"></a>decorateChild ⟨add(lit(<span class="dv">3</span>), lit(<span class="dv">4</span>))⟩</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;let_&quot;</span>) [⟨<span class="st">&quot;x&quot;</span>⟩] _ [⟨sub(var(<span class="st">&quot;x&quot;</span>), lit(<span class="dv">5</span>))⟩]</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>) [⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩] _ []</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true"></a><span class="kw">in</span> decorateSetRootAttrs _ { context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span> }</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true"></a><span class="kw">in</span> force (_<span class="op">.</span>value)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span></code></pre></div>
<p>Again, we traverse down.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true"></a>decorateChild ⟨lit(<span class="dv">3</span>)⟩</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>) [] _ [⟨lit(<span class="dv">4</span>)⟩]</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;let_&quot;</span>) [⟨<span class="st">&quot;x&quot;</span>⟩] _ [⟨sub(var(<span class="st">&quot;x&quot;</span>), lit(<span class="dv">5</span>))⟩]</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>) [⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩] _ []</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true"></a><span class="kw">in</span> decorateSetRootAttrs _ { context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span> }</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true"></a><span class="kw">in</span> force (_<span class="op">.</span>value)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span></code></pre></div>
<p>Skipping a few steps, until both <code>⟨lit(3)⟩</code> and <code>⟨lit(4)⟩</code> are decorated…</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true"></a>decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>) [⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩] ⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩ []</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;let_&quot;</span>) [⟨<span class="st">&quot;x&quot;</span>⟩] _ [⟨sub(var(<span class="st">&quot;x&quot;</span>), lit(<span class="dv">5</span>))⟩]</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>) [⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩] _ []</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true"></a><span class="kw">in</span> decorateSetRootAttrs _ { context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span> }</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true"></a><span class="kw">in</span> force (_<span class="op">.</span>value)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span></code></pre></div>
<p>Now, the <code>add</code> production bodies can be run.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true"></a>(lam [<span class="st">&quot;top&quot;</span>] <span class="op">$</span> (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span><span class="dv">0</span><span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span>context<span class="op">&gt;</span> <span class="kw">then</span> (var <span class="st">&quot;top&quot;</span>))(⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true"></a><span class="kw">in</span> (lam [<span class="st">&quot;top&quot;</span>] <span class="op">$</span> (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span><span class="dv">1</span><span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span>context<span class="op">&gt;</span> <span class="kw">then</span> (var <span class="st">&quot;top&quot;</span>))(_)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true"></a><span class="kw">in</span> (lam [<span class="st">&quot;top&quot;</span>] <span class="op">$</span> (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span> <span class="kw">then</span> (var <span class="st">&quot;top&quot;</span>))(_)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;let_&quot;</span>) [⟨<span class="st">&quot;x&quot;</span>⟩] _ [⟨sub(var(<span class="st">&quot;x&quot;</span>), lit(<span class="dv">5</span>))⟩]</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>) [⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩] _ []</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true"></a><span class="kw">in</span> decorateSetRootAttrs _ { context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span> }</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true"></a><span class="kw">in</span> force (_<span class="op">.</span>value)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span></code></pre></div>
<p>Again, beta-reduce.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true"></a>⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span> <span class="kw">then</span> ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true"></a><span class="kw">in</span> (lam [<span class="st">&quot;top&quot;</span>] <span class="op">$</span> (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span><span class="dv">1</span><span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span>context<span class="op">&gt;</span> <span class="kw">then</span> (var <span class="st">&quot;top&quot;</span>))(_)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true"></a><span class="kw">in</span> (lam [<span class="st">&quot;top&quot;</span>] <span class="op">$</span> (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span> <span class="kw">then</span> (var <span class="st">&quot;top&quot;</span>))(_)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;let_&quot;</span>) [⟨<span class="st">&quot;x&quot;</span>⟩] _ [⟨sub(var(<span class="st">&quot;x&quot;</span>), lit(<span class="dv">5</span>))⟩]</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>) [⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩] _ []</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true"></a><span class="kw">in</span> decorateSetRootAttrs _ { context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span> }</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true"></a><span class="kw">in</span> force (_<span class="op">.</span>value)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span></code></pre></div>
<p>Reduce the lvalue.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true"></a>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span> <span class="kw">then</span> ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true"></a><span class="kw">in</span> (lam [<span class="st">&quot;top&quot;</span>] <span class="op">$</span> (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span><span class="dv">1</span><span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span>context<span class="op">&gt;</span> <span class="kw">then</span> (var <span class="st">&quot;top&quot;</span>))(_)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true"></a><span class="kw">in</span> (lam [<span class="st">&quot;top&quot;</span>] <span class="op">$</span> (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span> <span class="kw">then</span> (var <span class="st">&quot;top&quot;</span>))(_)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;let_&quot;</span>) [⟨<span class="st">&quot;x&quot;</span>⟩] _ [⟨sub(var(<span class="st">&quot;x&quot;</span>), lit(<span class="dv">5</span>))⟩]</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>) [⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩] _ []</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true"></a><span class="kw">in</span> decorateSetRootAttrs _ { context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span> }</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true"></a><span class="kw">in</span> force (_<span class="op">.</span>value)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span></code></pre></div>
<p>Perform the mutation.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true"></a>⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true"></a><span class="kw">in</span> (lam [<span class="st">&quot;top&quot;</span>] <span class="op">$</span> (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span><span class="dv">1</span><span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span>context<span class="op">&gt;</span> <span class="kw">then</span> (var <span class="st">&quot;top&quot;</span>))(_)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true"></a><span class="kw">in</span> (lam [<span class="st">&quot;top&quot;</span>] <span class="op">$</span> (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span> <span class="kw">then</span> (var <span class="st">&quot;top&quot;</span>))(_)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;let_&quot;</span>) [⟨<span class="st">&quot;x&quot;</span>⟩] _ [⟨sub(var(<span class="st">&quot;x&quot;</span>), lit(<span class="dv">5</span>))⟩]</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>) [⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩] _ []</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true"></a><span class="kw">in</span> decorateSetRootAttrs _ { context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span> }</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true"></a><span class="kw">in</span> force (_<span class="op">.</span>value)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span></code></pre></div>
<p>Call the continuation and beta-reduce, reduce the lvalue, and perform the mutation again.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true"></a>(lam [<span class="st">&quot;top&quot;</span>] <span class="op">$</span> (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true"></a>               <span class="kw">then</span> (var <span class="st">&quot;top&quot;</span>))(⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;let_&quot;</span>) [⟨<span class="st">&quot;x&quot;</span>⟩] _ [⟨sub(var(<span class="st">&quot;x&quot;</span>), lit(<span class="dv">5</span>))⟩]</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>) [⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩] _ []</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true"></a><span class="kw">in</span> decorateSetRootAttrs _ { context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span> }</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true"></a><span class="kw">in</span> force (_<span class="op">.</span>value)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span></code></pre></div>
<p>Beta-reduce again.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true"></a>⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>value <span class="ot">=</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true"></a>    <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true"></a><span class="kw">then</span> ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;let_&quot;</span>) [⟨<span class="st">&quot;x&quot;</span>⟩] _ [⟨sub(var(<span class="st">&quot;x&quot;</span>), lit(<span class="dv">5</span>))⟩]</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>) [⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩] _ []</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true"></a><span class="kw">in</span> decorateSetRootAttrs _ { context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span> }</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true"></a><span class="kw">in</span> force (_<span class="op">.</span>value)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span></code></pre></div>
<p>Perform the mutation.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true"></a>⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;let_&quot;</span>) [⟨<span class="st">&quot;x&quot;</span>⟩] _ [⟨sub(var(<span class="st">&quot;x&quot;</span>), lit(<span class="dv">5</span>))⟩]</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>) [⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩] _ []</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true"></a><span class="kw">in</span> decorateSetRootAttrs _ { context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span> }</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true"></a><span class="kw">in</span> force (_<span class="op">.</span>value)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span></code></pre></div>
<p>The <code>⟨add(lit(3), lit(4))⟩</code> subterm is now fully decorated! In the interest of making this not terribly slow, I’ll skip over the decoration of <code>⟨sub(var("x"), lit(5))⟩</code>.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true"></a>decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;let_&quot;</span>) [⟨<span class="st">&quot;x&quot;</span>⟩, ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩] ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩ []</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>) [⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩] _ []</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true"></a><span class="kw">in</span> decorateSetRootAttrs _ { context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span> }</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true"></a><span class="kw">in</span> force (_<span class="op">.</span>value)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ((force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))(<span class="op">&lt;</span>force ⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span>context<span class="op">&gt;</span>, <span class="op">&lt;</span>⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>))<span class="op">&gt;</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">5</span>)<span class="op">@</span>l5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span></code></pre></div>
<p>The <code>let_</code> production bodies can now be run.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true"></a>⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true"></a><span class="kw">in</span> (lam [<span class="st">&quot;top&quot;</span>] <span class="op">$</span> (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span><span class="dv">1</span><span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span>context<span class="op">&gt;</span> <span class="kw">then</span> (var <span class="st">&quot;top&quot;</span>))(_)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true"></a><span class="kw">in</span> (lam [<span class="st">&quot;top&quot;</span>] <span class="op">$</span> (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span><span class="dv">2</span><span class="op">.</span>value<span class="op">&gt;</span> <span class="kw">then</span> (var <span class="st">&quot;top&quot;</span>))(_)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true"></a><span class="kw">in</span> (lam [<span class="st">&quot;top&quot;</span>] <span class="op">$</span> (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span><span class="dv">2</span><span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨cons(<span class="op">&lt;</span>⟨pair(<span class="op">&lt;</span>(var <span class="st">&quot;top&quot;</span>)<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>, (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩<span class="op">&gt;</span>, (var <span class="st">&quot;top&quot;</span>)<span class="op">.</span>context)⟩<span class="op">&gt;</span> <span class="kw">then</span> (var <span class="st">&quot;top&quot;</span>))(_)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true"></a><span class="kw">in</span> decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>) [⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩] _ []</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true"></a><span class="kw">in</span> decorateSetRootAttrs _ { context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span> }</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true"></a><span class="kw">in</span> force (_<span class="op">.</span>value)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ((force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))(<span class="op">&lt;</span>force ⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span>context<span class="op">&gt;</span>, <span class="op">&lt;</span>⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>))<span class="op">&gt;</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">5</span>)<span class="op">@</span>l5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span></code></pre></div>
<p>I’ll speed through these again.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true"></a>decorateChildren (<span class="st">&quot;arith&quot;</span>, <span class="st">&quot;add&quot;</span>) [⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩]</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true"></a>    ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true"></a>    []</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true"></a><span class="kw">in</span> decorateSetRootAttrs _ { context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span> }</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true"></a><span class="kw">in</span> force (_<span class="op">.</span>value)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ((force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))(<span class="op">&lt;</span>force ⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span>context<span class="op">&gt;</span>, <span class="op">&lt;</span>⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>))<span class="op">&gt;</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">5</span>)<span class="op">@</span>l5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">2</span><span class="op">.</span>value<span class="op">&gt;</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨cons(<span class="op">&lt;</span>⟨pair(<span class="op">&lt;</span>⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>,</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true"></a>                                     ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩<span class="op">&gt;</span>,</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true"></a>                              ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩<span class="op">&gt;</span></span></code></pre></div>
<p>Now, we run the <code>add</code> production bodies; again doing this in one step.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true"></a>decorateSetRootAttrs </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true"></a>  ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true"></a>  { context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span> }</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true"></a><span class="kw">in</span> force (_<span class="op">.</span>value)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ((force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))(<span class="op">&lt;</span>force ⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span>context<span class="op">&gt;</span>, <span class="op">&lt;</span>⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>))<span class="op">&gt;</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">5</span>)<span class="op">@</span>l5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">2</span><span class="op">.</span>value<span class="op">&gt;</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨cons(<span class="op">&lt;</span>⟨pair(<span class="op">&lt;</span>⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>,</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true"></a>                                     ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩<span class="op">&gt;</span>,</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true"></a>                              ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩<span class="op">&gt;</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true"></a>  [ force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true"></a>  , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true"></a>  ]<span class="op">&gt;</span></span></code></pre></div>
<p>Finally, we set the attributes on the root node provided to the initial <code>decorate</code> call.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true"></a>force (⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>value)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ((force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))(<span class="op">&lt;</span>force ⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span>context<span class="op">&gt;</span>, <span class="op">&lt;</span>⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>))<span class="op">&gt;</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">5</span>)<span class="op">@</span>l5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">2</span><span class="op">.</span>value<span class="op">&gt;</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨cons(<span class="op">&lt;</span>⟨pair(<span class="op">&lt;</span>⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>,</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true"></a>                                     ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩<span class="op">&gt;</span>,</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true"></a>                              ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩<span class="op">&gt;</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true"></a>  [ force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true"></a>  , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true"></a>  ]<span class="op">&gt;</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span></span></code></pre></div>
<p>We’ve finally finished building up the tree; now we can finally get to attribute evaluation.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true"></a>force (⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>value)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ((force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))(<span class="op">&lt;</span>force ⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span>context<span class="op">&gt;</span>, <span class="op">&lt;</span>⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>))<span class="op">&gt;</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">5</span>)<span class="op">@</span>l5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">2</span><span class="op">.</span>value<span class="op">&gt;</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨cons(<span class="op">&lt;</span>⟨pair(<span class="op">&lt;</span>⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>,</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true"></a>                                     ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩<span class="op">&gt;</span>,</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true"></a>                              ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩<span class="op">&gt;</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true"></a>  [ force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true"></a>  , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true"></a>  ]<span class="op">&gt;</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span></span></code></pre></div>
<p>We can pull the <code>value</code> attribute off of the tree and start evaluating it.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true"></a>pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true"></a>  [ force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true"></a>  , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true"></a>  ]</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ((force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))(<span class="op">&lt;</span>force ⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span>context<span class="op">&gt;</span>, <span class="op">&lt;</span>⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>))<span class="op">&gt;</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">5</span>)<span class="op">@</span>l5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">2</span><span class="op">.</span>value<span class="op">&gt;</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨cons(<span class="op">&lt;</span>⟨pair(<span class="op">&lt;</span>⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>,</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true"></a>                                     ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩<span class="op">&gt;</span>,</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true"></a>                              ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩<span class="op">&gt;</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true"></a>  [ force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true"></a>  , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true"></a>  ]<span class="op">&gt;</span></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span></span></code></pre></div>
<p>We need to evaluate each argument to the foreign function.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true"></a>force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true"></a>     [ _</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true"></a>     , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true"></a>     ]</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ((force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))(<span class="op">&lt;</span>force ⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span>context<span class="op">&gt;</span>, <span class="op">&lt;</span>⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>))<span class="op">&gt;</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">5</span>)<span class="op">@</span>l5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">2</span><span class="op">.</span>value<span class="op">&gt;</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨cons(<span class="op">&lt;</span>⟨pair(<span class="op">&lt;</span>⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>,</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true"></a>                                     ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩<span class="op">&gt;</span>,</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true"></a>                              ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩<span class="op">&gt;</span></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true"></a>  [ force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true"></a>  , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true"></a>  ]<span class="op">&gt;</span></span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span></span></code></pre></div>
<p>Evaluate the <code>.0</code>.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true"></a>force ⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span>value</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true"></a>     [ _</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true"></a>     , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true"></a>     ]</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ((force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))(<span class="op">&lt;</span>force ⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span>context<span class="op">&gt;</span>, <span class="op">&lt;</span>⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>))<span class="op">&gt;</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">5</span>)<span class="op">@</span>l5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">2</span><span class="op">.</span>value<span class="op">&gt;</span></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨cons(<span class="op">&lt;</span>⟨pair(<span class="op">&lt;</span>⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>,</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true"></a>                                     ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩<span class="op">&gt;</span>,</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true"></a>                              ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩<span class="op">&gt;</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true"></a>  [ force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true"></a>  , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true"></a>  ]<span class="op">&gt;</span></span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span></span></code></pre></div>
<p>Start evaluating the thunk.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true"></a>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>l2<span class="op">.</span>value _</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true"></a>     [ _</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true"></a>     , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true"></a>     ]</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ((force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))(<span class="op">&lt;</span>force ⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span>context<span class="op">&gt;</span>, <span class="op">&lt;</span>⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>))<span class="op">&gt;</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">5</span>)<span class="op">@</span>l5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">2</span><span class="op">.</span>value<span class="op">&gt;</span></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨cons(<span class="op">&lt;</span>⟨pair(<span class="op">&lt;</span>⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>,</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true"></a>                                     ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩<span class="op">&gt;</span>,</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true"></a>                              ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩<span class="op">&gt;</span></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true"></a>  [ force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true"></a>  , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true"></a>  ]<span class="op">&gt;</span></span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span></span></code></pre></div>
<p>Now we can evaluate <code>.0</code> to finish evaluating that branch of the computation.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true"></a><span class="dv">2</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>l2<span class="op">.</span>value _</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true"></a>     [ _</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true"></a>     , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true"></a>     ]</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">2</span>)<span class="op">@</span>l2⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ((force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))(<span class="op">&lt;</span>force ⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span>context<span class="op">&gt;</span>, <span class="op">&lt;</span>⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>))<span class="op">&gt;</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">5</span>)<span class="op">@</span>l5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">2</span><span class="op">.</span>value<span class="op">&gt;</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨cons(<span class="op">&lt;</span>⟨pair(<span class="op">&lt;</span>⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>,</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true"></a>                                     ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩<span class="op">&gt;</span>,</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true"></a>                              ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩<span class="op">&gt;</span></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true"></a>  [ force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true"></a>  , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true"></a>  ]<span class="op">&gt;</span></span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span></span></code></pre></div>
<p>We apply <code>2</code> to the continuation, which simplifies the <code>@l2.value</code> thunk (now that it’s evaluated).</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true"></a><span class="dv">2</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true"></a>     [ _</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true"></a>     , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true"></a>     ]</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> «2»</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ((force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))(<span class="op">&lt;</span>force ⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span>context<span class="op">&gt;</span>, <span class="op">&lt;</span>⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>))<span class="op">&gt;</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">5</span>)<span class="op">@</span>l5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">2</span><span class="op">.</span>value<span class="op">&gt;</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨cons(<span class="op">&lt;</span>⟨pair(<span class="op">&lt;</span>⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>,</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true"></a>                                     ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩<span class="op">&gt;</span>,</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true"></a>                              ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩<span class="op">&gt;</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true"></a>  [ force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true"></a>  , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true"></a>  ]<span class="op">&gt;</span></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span></span></code></pre></div>
<p>Now we need to evaluate the other argument to <code>add-int</code>.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true"></a>force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;add-int&quot;</span> [<span class="dv">2</span>, _]</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> «2»</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ((force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))(<span class="op">&lt;</span>force ⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span>context<span class="op">&gt;</span>, <span class="op">&lt;</span>⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>))<span class="op">&gt;</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">5</span>)<span class="op">@</span>l5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">2</span><span class="op">.</span>value<span class="op">&gt;</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨cons(<span class="op">&lt;</span>⟨pair(<span class="op">&lt;</span>⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>,</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true"></a>                                     ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩<span class="op">&gt;</span>,</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true"></a>                              ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩<span class="op">&gt;</span></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true"></a>  [ force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true"></a>  , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true"></a>  ]<span class="op">&gt;</span></span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span></span></code></pre></div>
<p>Again, we do the <code>getChild</code> then force the thunk.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true"></a>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">2</span><span class="op">.</span>value</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;add-int&quot;</span> [<span class="dv">2</span>, _]</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> «2»</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ((force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))(<span class="op">&lt;</span>force ⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span>context<span class="op">&gt;</span>, <span class="op">&lt;</span>⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>))<span class="op">&gt;</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">5</span>)<span class="op">@</span>l5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">2</span><span class="op">.</span>value<span class="op">&gt;</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨cons(<span class="op">&lt;</span>⟨pair(<span class="op">&lt;</span>⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>,</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true"></a>                                     ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩<span class="op">&gt;</span>,</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true"></a>                              ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩<span class="op">&gt;</span></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true"></a>  [ force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true"></a>  , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true"></a>  ]<span class="op">&gt;</span></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span></span></code></pre></div>
<p>This left us with another <code>force</code> expression as our control expression, so let’s do the same thing again.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true"></a>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>svxl5<span class="op">.</span>value _</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;add-int&quot;</span> [<span class="dv">2</span>, _]</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> «2»</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ((force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))(<span class="op">&lt;</span>force ⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span>context<span class="op">&gt;</span>, <span class="op">&lt;</span>⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>))<span class="op">&gt;</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">5</span>)<span class="op">@</span>l5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">2</span><span class="op">.</span>value<span class="op">&gt;</span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨cons(<span class="op">&lt;</span>⟨pair(<span class="op">&lt;</span>⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>,</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true"></a>                                     ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩<span class="op">&gt;</span>,</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true"></a>                              ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩<span class="op">&gt;</span></span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true"></a>  [ force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true"></a>  , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true"></a>  ]<span class="op">&gt;</span></span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span></span></code></pre></div>
<p>Again we need to evaluate each argument to the foreign function.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true"></a>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;sub-int&quot;</span> [_, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>svxl5<span class="op">.</span>value _</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;add-int&quot;</span> [<span class="dv">2</span>, _]</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> «2»</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ((force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))(<span class="op">&lt;</span>force ⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span>context<span class="op">&gt;</span>, <span class="op">&lt;</span>⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>))<span class="op">&gt;</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">5</span>)<span class="op">@</span>l5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">2</span><span class="op">.</span>value<span class="op">&gt;</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨cons(<span class="op">&lt;</span>⟨pair(<span class="op">&lt;</span>⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>,</span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true"></a>                                     ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩<span class="op">&gt;</span>,</span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true"></a>                              ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩<span class="op">&gt;</span></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true"></a>  [ force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true"></a>  , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true"></a>  ]<span class="op">&gt;</span></span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span></span></code></pre></div>
<p>Another <code>getChild</code> + <code>force</code>…</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true"></a>force ((force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))(<span class="op">&lt;</span>force ⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span>context<span class="op">&gt;</span>, <span class="op">&lt;</span>⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>))</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>vx<span class="op">.</span>value _</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;sub-int&quot;</span> [_, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>svxl5<span class="op">.</span>value _</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;add-int&quot;</span> [<span class="dv">2</span>, _]</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> «2»</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ((force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))(<span class="op">&lt;</span>force ⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span>context<span class="op">&gt;</span>, <span class="op">&lt;</span>⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>))<span class="op">&gt;</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">5</span>)<span class="op">@</span>l5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">2</span><span class="op">.</span>value<span class="op">&gt;</span></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨cons(<span class="op">&lt;</span>⟨pair(<span class="op">&lt;</span>⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>,</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true"></a>                                     ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩<span class="op">&gt;</span>,</span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true"></a>                              ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩<span class="op">&gt;</span></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true"></a>  [ force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true"></a>  , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true"></a>  ]<span class="op">&gt;</span></span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span></span></code></pre></div>
<p>Now we have a function call as the argument to <code>force</code>.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true"></a>(force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))(<span class="op">&lt;</span>force ⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span>context<span class="op">&gt;</span>, <span class="op">&lt;</span>⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true"></a><span class="kw">in</span> force _</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>vx<span class="op">.</span>value _</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;sub-int&quot;</span> [_, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>svxl5<span class="op">.</span>value _</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;add-int&quot;</span> [<span class="dv">2</span>, _]</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> «2»</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ((force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))(<span class="op">&lt;</span>force ⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span>context<span class="op">&gt;</span>, <span class="op">&lt;</span>⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>))<span class="op">&gt;</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">5</span>)<span class="op">@</span>l5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">2</span><span class="op">.</span>value<span class="op">&gt;</span></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨cons(<span class="op">&lt;</span>⟨pair(<span class="op">&lt;</span>⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>,</span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true"></a>                                     ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩<span class="op">&gt;</span>,</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true"></a>                              ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩<span class="op">&gt;</span></span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true"></a>  [ force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true"></a>  , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true"></a>  ]<span class="op">&gt;</span></span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span></span></code></pre></div>
<p>Since we decided to skip over pattern-matching, globals, etc., I’ll evaluate it in a single step.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true"></a>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>vx<span class="op">.</span>value _</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;sub-int&quot;</span> [_, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>svxl5<span class="op">.</span>value _</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;add-int&quot;</span> [<span class="dv">2</span>, _]</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> «2»</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ((force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))(<span class="op">&lt;</span>force ⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span>context<span class="op">&gt;</span>, <span class="op">&lt;</span>⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>))<span class="op">&gt;</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">5</span>)<span class="op">@</span>l5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> «⟨cons(«⟨pair(«<span class="st">&quot;x&quot;</span>», ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩»,</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true"></a>                           ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩»</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">2</span><span class="op">.</span>value<span class="op">&gt;</span></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>context <span class="ot">=</span> «⟨cons(«⟨pair(«<span class="st">&quot;x&quot;</span>», ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩»,</span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true"></a>                              ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩»</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true"></a>  [ force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true"></a>  , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true"></a>  ]<span class="op">&gt;</span></span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span></span></code></pre></div>
<p>We can now evaluate the thunk we looked up.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true"></a>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>al3l4<span class="op">.</span>value _</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>vx<span class="op">.</span>value _</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;sub-int&quot;</span> [_, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>svxl5<span class="op">.</span>value _</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;add-int&quot;</span> [<span class="dv">2</span>, _]</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> «2»</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ((force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))(<span class="op">&lt;</span>force ⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span>context<span class="op">&gt;</span>, <span class="op">&lt;</span>⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>))<span class="op">&gt;</span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">5</span>)<span class="op">@</span>l5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> «⟨cons(«⟨pair(«<span class="st">&quot;x&quot;</span>», ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩»,</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true"></a>                           ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩»</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">2</span><span class="op">.</span>value<span class="op">&gt;</span></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>context <span class="ot">=</span> «⟨cons(«⟨pair(«<span class="st">&quot;x&quot;</span>», ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩»,</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true"></a>                              ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩»</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true"></a>  [ force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true"></a>  , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true"></a>  ]<span class="op">&gt;</span></span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span></span></code></pre></div>
<p>Again, we start evaluating the function’s arguments.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true"></a>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;add-int&quot;</span> [_, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>al3l4<span class="op">.</span>value _</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>vx<span class="op">.</span>value _</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;sub-int&quot;</span> [_, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>svxl5<span class="op">.</span>value _</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;add-int&quot;</span> [<span class="dv">2</span>, _]</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> «2»</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ((force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))(<span class="op">&lt;</span>force ⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span>context<span class="op">&gt;</span>, <span class="op">&lt;</span>⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>))<span class="op">&gt;</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">5</span>)<span class="op">@</span>l5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> «⟨cons(«⟨pair(«<span class="st">&quot;x&quot;</span>», ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩»,</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true"></a>                           ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩»</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">2</span><span class="op">.</span>value<span class="op">&gt;</span></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>context <span class="ot">=</span> «⟨cons(«⟨pair(«<span class="st">&quot;x&quot;</span>», ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩»,</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true"></a>                              ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩»</span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true"></a>  [ force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true"></a>  , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true"></a>  ]<span class="op">&gt;</span></span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span></span></code></pre></div>
<p>And again, <code>getChild</code> + <code>force</code>.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true"></a>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>l3<span class="op">.</span>value _</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;add-int&quot;</span> [_, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>al3l4<span class="op">.</span>value _</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>vx<span class="op">.</span>value _</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;sub-int&quot;</span> [_, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>svxl5<span class="op">.</span>value _</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;add-int&quot;</span> [<span class="dv">2</span>, _]</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> «2»</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">3</span>)<span class="op">@</span>l3⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">4</span>)<span class="op">@</span>l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ((force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))(<span class="op">&lt;</span>force ⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span>context<span class="op">&gt;</span>, <span class="op">&lt;</span>⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>))<span class="op">&gt;</span></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">5</span>)<span class="op">@</span>l5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> «⟨cons(«⟨pair(«<span class="st">&quot;x&quot;</span>», ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩»,</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true"></a>                           ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩»</span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">2</span><span class="op">.</span>value<span class="op">&gt;</span></span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>context <span class="ot">=</span> «⟨cons(«⟨pair(«<span class="st">&quot;x&quot;</span>», ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩»,</span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true"></a>                              ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩»</span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true"></a>  [ force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true"></a>  , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true"></a>  ]<span class="op">&gt;</span></span>
<span id="cb67-33"><a href="#cb67-33" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span></span></code></pre></div>
<p>We can now pull out the <code>3</code>, write it back to the thunk, and start evaluating the <code>⟨lit(4)@l4⟩</code>’s <code>value</code>. For brevity, I’ll fast-forward through that.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true"></a>pureForeign <span class="st">&quot;add-int&quot;</span> [<span class="dv">3</span>, <span class="dv">4</span>]</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>al3l4<span class="op">.</span>value _</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>vx<span class="op">.</span>value _</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;sub-int&quot;</span> [_, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>svxl5<span class="op">.</span>value _</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;add-int&quot;</span> [<span class="dv">2</span>, _]</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> «2»</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> «3»</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> «4»</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span> [force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ((force (global (<span class="st">&quot;silver:core&quot;</span>, <span class="st">&quot;lookupOrError&quot;</span>)))(<span class="op">&lt;</span>force ⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span>context<span class="op">&gt;</span>, <span class="op">&lt;</span>⟨var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span>))<span class="op">&gt;</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">5</span>)<span class="op">@</span>l5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> «⟨cons(«⟨pair(«<span class="st">&quot;x&quot;</span>», ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩»,</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true"></a>                           ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩»</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">2</span><span class="op">.</span>value<span class="op">&gt;</span></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>context <span class="ot">=</span> «⟨cons(«⟨pair(«<span class="st">&quot;x&quot;</span>», ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩»,</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true"></a>                              ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩»</span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true"></a>  [ force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true"></a>  , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true"></a>  ]<span class="op">&gt;</span></span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span></span></code></pre></div>
<p>We now invoke the <code>add-int</code> foreign function, and write back the result to the appropriate thunks.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true"></a>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;sub-int&quot;</span> [<span class="dv">7</span>, _]</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>svxl5<span class="op">.</span>value _</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;add-int&quot;</span> [<span class="dv">2</span>, _]</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> «2»</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> «3»</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> «4»</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> «7»</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> «7»</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>⟨lit(<span class="dv">5</span>)<span class="op">@</span>l5⟩<span class="op">.</span><span class="dv">0</span><span class="op">&gt;</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> «⟨cons(«⟨pair(«<span class="st">&quot;x&quot;</span>», ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩»,</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true"></a>                           ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩»</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">2</span><span class="op">.</span>value<span class="op">&gt;</span></span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>context <span class="ot">=</span> «⟨cons(«⟨pair(«<span class="st">&quot;x&quot;</span>», ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩»,</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true"></a>                              ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩»</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true"></a>  [ force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true"></a>  , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true"></a>  ]<span class="op">&gt;</span></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span></span></code></pre></div>
<p>We’ll skip through <code>⟨lit(5)@l5⟩.value</code>’s evaluation too.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true"></a>pureForeign <span class="st">&quot;sub-int&quot;</span> [<span class="dv">7</span>, <span class="dv">5</span>]</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>svxl5<span class="op">.</span>value _</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true"></a><span class="kw">in</span> pureForeign <span class="st">&quot;add-int&quot;</span> [<span class="dv">2</span>, _]</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> «2»</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> «3»</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> «4»</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> «7»</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> «7»</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> «5»</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> «⟨cons(«⟨pair(«<span class="st">&quot;x&quot;</span>», ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩»,</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true"></a>                           ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩»</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;sub-int&quot;</span> [force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value, force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value]<span class="op">&gt;</span></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">2</span><span class="op">.</span>value<span class="op">&gt;</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>context <span class="ot">=</span> «⟨cons(«⟨pair(«<span class="st">&quot;x&quot;</span>», ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩»,</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true"></a>                              ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩»</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true"></a>  [ force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true"></a>  , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true"></a>  ]<span class="op">&gt;</span></span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span></span></code></pre></div>
<p>Again we can perform the foreign function call and write it back to the appropriate thunks.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true"></a>pureForeign <span class="st">&quot;add-int&quot;</span> [<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true"></a><span class="kw">in</span> writebackToThunk <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value _</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> «2»</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> «3»</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> «4»</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> «7»</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> «7»</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> «5»</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> «⟨cons(«⟨pair(«<span class="st">&quot;x&quot;</span>», ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩»,</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true"></a>                           ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩»</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> «2»</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> «2»</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>context <span class="ot">=</span> «⟨cons(«⟨pair(«<span class="st">&quot;x&quot;</span>», ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩»,</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true"></a>                              ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩»</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> <span class="op">&lt;</span>pureForeign <span class="st">&quot;add-int&quot;</span></span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true"></a>  [ force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">0</span><span class="op">.</span>value</span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true"></a>  , force ⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value</span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true"></a>  ]<span class="op">&gt;</span></span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span></span></code></pre></div>
<p>And again…</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true"></a><span class="dv">4</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>value <span class="ot">=</span> «2»</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>value <span class="ot">=</span> «3»</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>value <span class="ot">=</span> «4»</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l3<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>value <span class="ot">=</span> «7»</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>value <span class="ot">=</span> «7»</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>value <span class="ot">=</span> «5»</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>vx<span class="op">.</span>context <span class="ot">=</span> «⟨cons(«⟨pair(«<span class="st">&quot;x&quot;</span>», ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩»,</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true"></a>                           ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩»</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>value <span class="ot">=</span> «2»</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al3l4<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>force ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> «2»</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>svxl5<span class="op">.</span>context <span class="ot">=</span> «⟨cons(«⟨pair(«<span class="st">&quot;x&quot;</span>», ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span><span class="dv">1</span><span class="op">.</span>value)⟩»,</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true"></a>                              ⟨let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5⟩<span class="op">.</span>context)⟩»</span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>l2<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨add(lit(<span class="dv">2</span>)<span class="op">@</span>l2, let_(<span class="st">&quot;x&quot;</span>, add(lit(<span class="dv">3</span>)<span class="op">@</span>l3, lit(<span class="dv">4</span>)<span class="op">@</span>l4)<span class="op">@</span>al3l4, sub(var(<span class="st">&quot;x&quot;</span>)<span class="op">@</span>vx, lit(<span class="dv">5</span>)<span class="op">@</span>l5)<span class="op">@</span>svxl5)<span class="op">@</span>lxal3l4svxl5)<span class="op">@</span>al2lxal3l4svxl5⟩<span class="op">.</span>context<span class="op">&gt;</span></span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>value <span class="ot">=</span> «4»</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true"></a><span class="kw">where</span> <span class="op">@</span>al2lxal3l4svxl5<span class="op">.</span>context <span class="ot">=</span> <span class="op">&lt;</span>⟨nil()⟩<span class="op">&gt;</span></span></code></pre></div>
<p>We’ve now finished evaluation, and got the expected result of 4.</p>
<h2 id="discussion">Discussion</h2>
<h3 id="tree-construction-order">Tree Construction Order</h3>
<p>Right now, trees have their attributes put on them at the same time (and order) as they are allocated. This significantly simplifies the semantics of the <code>decorate</code> node, and ensures only a single pass over the tree is needed at tree-construction-time.</p>
<p>The current approach looks like:</p>
<ul>
<li>Perform this process for all nonterminal children with an empty set of attributes.</li>
<li>Allocate a tree whose children are the decorated children (with non-nonterminal children in the same positions), with the same annotations as the original term, and with the attributes provided to decorate.</li>
<li>Run all the production bodies in priority order on the tree.</li>
</ul>
<p>An alternate approach is possible:</p>
<ul>
<li>Allocate the entire tree, with new tree nodes for nonterminal children.</li>
<li>For each node from the root on down,
<ul>
<li>Run all the productions with negative priority on the tree, in priority order (<code>-2</code> before <code>-1</code>).</li>
<li>Perform this process on each nonterminal child.</li>
<li>Run all the productions with non-negative priority on the tree, in priority order (<code>0</code> before <code>1</code>).</li>
</ul></li>
</ul>
<p>However, the tree-construction process is already fairly complicated.</p>
</body>
</html>
