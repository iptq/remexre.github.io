<!doctype html>
<html lang="en">
  <head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Notebook: Stahl (Language)</title><link rel="stylesheet" type="text/css"
       href="https://remexre.xyz/css/main.css"><link rel="stylesheet" type="text/css"
       href="https://remexre.xyz/css/monokai-sublime.min.css"><style>article { width: calc(100% - 1.0rem); }</style></head>
  <body>
    <header>
      <a class="subtle" href="https://remexre.xyz/">Home</a>
      <a class="subtle" href="https://remexre.xyz/contact">Contact</a>
      <a class="subtle" href="https://remexre.xyz/projects">Projects</a>
    </header>
    <div class="spacer"></div>
    <article><h1 class="title"><a class="subtle" href="https://remexre.xyz/notebooks/stahl-lang">Notebook: Stahl (Language)</a><span class="spacer"></span><span class="meta">Draft</span></h1><h1>main function</h1>
<p>with Haskell syntax:</p>
<pre class="hljs"><code class="language-haskell"><span class="hljs-comment">-- defined by main module</span>
<span class="hljs-class"><span class="hljs-keyword">data</span> <span class="hljs-type">State</span></span>
<span class="hljs-title">initState</span> :: <span class="hljs-type">State</span>
<span class="hljs-title">initState</span> = undefined
<span class="hljs-title">main</span> :: [<span class="hljs-type">Message</span>] -&gt; <span class="hljs-type">IO</span> <span class="hljs-type">State</span> ()
<span class="hljs-title">main</span> = undefined

<span class="hljs-title">entrypoint</span> :: [<span class="hljs-type">Message</span>] -&gt; <span class="hljs-type">State</span> -&gt; ([<span class="hljs-type">Message</span>], <span class="hljs-type">Maybe</span> <span class="hljs-type">State</span>)
<span class="hljs-title">entrypoint</span> = runIO . main

<span class="hljs-comment">-- Approximately ContT () (WriterT [Message] (StateT s Maybe)) a</span>
<span class="hljs-class"><span class="hljs-keyword">data</span> <span class="hljs-type">IO</span> s a</span>
  = <span class="hljs-type">MkIO</span> ((a -&gt; s -&gt; ([<span class="hljs-type">Message</span>], <span class="hljs-type">Maybe</span> s)) -&gt; s -&gt; ([<span class="hljs-type">Message</span>], <span class="hljs-type">Maybe</span> s))
  <span class="hljs-keyword">deriving</span> (<span class="hljs-type">Functor</span>, <span class="hljs-type">Applicative</span>, <span class="hljs-type">Monad</span>)

<span class="hljs-title">runIO</span> :: <span class="hljs-type">IO</span> <span class="hljs-type">State</span> () -&gt; <span class="hljs-type">State</span> -&gt; ([<span class="hljs-type">Message</span>], <span class="hljs-type">Maybe</span> <span class="hljs-type">State</span>)
<span class="hljs-title">runIO</span> (<span class="hljs-type">MkIO</span> k) st = k (\(), st =&gt; ([], <span class="hljs-type">Just</span> st)) st

<span class="hljs-title">send</span> :: <span class="hljs-type">Message</span> -&gt; <span class="hljs-type">IO</span> s ()
<span class="hljs-title">send</span> = undefined

<span class="hljs-title">modifyIO</span> :: (s -&gt; (s, a)) -&gt; <span class="hljs-type">IO</span> s a
<span class="hljs-title">modifyIO</span> = undefined

<span class="hljs-title">callCCIO</span> :: ((a -&gt; <span class="hljs-type">IO</span> s b) -&gt; <span class="hljs-type">IO</span> s a) -&gt; <span class="hljs-type">IO</span> s a
<span class="hljs-title">callCCIO</span> = undefined

<span class="hljs-title">exit</span> :: <span class="hljs-type">IO</span> a
<span class="hljs-title">exit</span> = undefined
</code></pre>
<p><strong>TODO:</strong> state and prove some laws -- notably to ensure callCC works</p>
</article><div class="comments">Comments are not enabled on this post.</div>
    <div class="spacer"></div>
    <script src="https://remexre.xyz/ext/anchor.min.js"></script><script>const anchors = new AnchorJS();anchors.options.class = "icon subtle";anchors.options.placement = "left";anchors.add("article h1:not(.title), article h2");</script>
  </body>
</html>
